 * 엔티티 등록
엔티티 매니저는 트랜잭션을 커밋하기 직전까지 데이터베이스에 엔티티를 저장하지 않고 내부 쿼리 저장소에 insert sql을 모아둔다. 커밋할때 모아둔 쿼리를 데이터베이스에 보낸다. 이것을 트랜잭션을 지원하는 쓰기 지연이라고 한다.


 * 엔티티 수정
변경감지는 영속성 컨텍스트가 관리하는 영속 상태의 엔티티에만 적용된다.
수정된 엔티티만 업데이트 되는 것이 아니라 엔티티의 모든 필드를 업데이트한다.
	-----------------------
		update meber
		set   name =?
			, age = ?
		where id = ?
	-----------------------
	-----------------------
		update meber
		set   name =?
			, age = ?
			, grant= ?
			...
		where id = ?
	-----------------------
장점은 쿼리가 항상 같기 때문에 데이터베이스는 이전에 한 번 파싱된 쿼리를 재사용할 수 있다.
단점은 데이터베이스에 보내는 데이터 전송량이 증가한다.

하이버네이트의 확장 기능을 사용하여 수정된 데이터만 업데이트 할 수 있다.
	-----------------------
	@Entity
	@org.hibernate.annotations.DynamicUpdate
	-----------------------

insert sql을 동적으로 생성하는 @DynamicInsert도 있다.


* 플러시
영속성 컨텍스트의 변경 내용를 데이터베이스에 반영한다.

 @구체적인 동작과정
	1) 변경 감지가 동작해서 영속성 컨텍스트에 있는 모든 엔티티를 스냅샷과 비교하영 변경사항을 쓰기 지연 SQL 저장소에 등록한다.
	2) 쓰기 지연 SQL 저장소의 쿼리를 데이터베이스로 전송한다.

 @영속성 컨텍스트 플러시 하는 방법 3가지
	- em.flush()를 직접 호출
		--> 테스트나 프레임워크와 JPA를 함께 사용할 때를 제외하고 거의 사용하지 않는다.

	- 트랜잭션 커밋 시 플러시 자동 호출
		--> 데이터베이스에 변경 내용을 SQL로 전달하지 않고 트랜잭션 커밋하면 어떤 데이터도 반영되지 않는다. JPA는 이런 문제를 예방하기 위해 트랜잭션 커밋할 때 플러시를 자동으로 호출한다.

	- JPQL 쿼리 실행시 플러시가 자동 호출
		--> JPQL이나 Ciriteria 같은 객체지향 쿼리를 호출할 때도 플러시가 실행된다.
			------------------------
				em.persist(memberA)
				em.persist(memberB)

				em.createQuery("select m from member m", Member.class).getResultList();
			------------------------
		em.persist()를 호출해서 엔티티를 영속성 상태로 만들었다. 이때 JPQL은 SQL로 변환되어 데이터베이스에서 엔티티를 조회한다. memebrA,B는 아직 데이터베이스에 반영되지 않았기 때문에 조회가 불가능하다. 그래서 쿼리를 실행하기 직전에 영속성 컨텍스트를 자동으로 플러시 하여 조회가 가능하도록 하고 있다.


* 플러시 모드 옵션
 엔티티 매니저에 플러시 모드 직접 지정
  - FlushModeType.AUTO : 커밋이나 쿼리를 실행할 때 플러시 (기본값)
  - FlushModeType.COMMIT : 커밋할 대만 플러시

	-------------------
		em.setFlushMode(FlushModeType.COMMIT)
	-------------------

영속성 컨텍스트를 지운다는 개념이 아니라 변경된 내용을 데이터베이스에 동기화하는 것이 플러시다.

* 준영속
영속 상태의 엔티티가 영속성 컨텍스트에서 분리(detached)된 상태.
준영속성 상태의 엔티티는 영속성 컨텍스트가 제공하는 기능을 사용할 수 없다.
준영속성 상태로 만드는 3가지 방법
    1. em.detach(entity) : 준영속성 상태로 전환
    2. em.clear() : 영속성 컨텍스트를 완전히 초기화
    3. em.close() : 영속성 컨텍스트를 종료한다.



